# 需求分析文档

## 1. 引言

### 1.1 **编写目的**

本文档用于描述“图文助手”项目的系统需求，为该项目概要设计，详细设计和测试用例的设计依据。

### 1.2 **项目背景**

项目委托单位：四川大学2022级 计算机学院《研究与开发实践》课程。
项目开发单位：计算机学院《研究与开发实践》课程 付少文小组。
在数字化时代，图像已成为信息传递的重要媒介。随着社交媒体和内容平台的兴起，图像的使用日益频繁，而对于能够智能识别、搜索和解释图像内容的需求也随之增加。当前市场上虽然存在一些图像搜索和识别工具，但多数集中在基本的图像识别和反向图像搜索功能，缺乏与用户交互性更强、更个性化的服务，比如根据文本描述精确搜索图像或者对图像内容进行详细解释。
此外，随着人工智能技术的发展，尤其是在深度学习和计算视觉领域的应用，现有技术已能支持更复杂的图像处理功能，为开发高级图像搜索和描述工具提供了技术基础。市场上对于一个能够结合文本搜索图像及解释图像内容的工具存在明显需求，特别是在教育、广告、设计等领域，这种工具可以极大地提高工作效率和创造力。
该项目主要采用JAVA，PostgreSQL，pyTorch等技术，是一款根据文本对图片进行检索和解释图片内容的安卓应用。
### 1.3 **定义和术语**

多模态检索：利用多种数据模态（如文本、图像、视频、音频等）进行信息检索的技术。
图像编码：在满足一定质量（信噪比的要求或主观评价得分）的条件下，以较少比特数表示图像或图像中所包含信息的技术。
文本编码：将文本数据编码为二进制数据的过程，以实现存储或传输的目的。
数据编码：用一个编码符号代表一条信息或一串数据。
数据压缩：在不丢失有用信息的前提下，缩减数据量以减少存储空间，提高其传输、存储和处理效率，或按照一定的算法对数据进行重新组织，减少数据的冗余和存储的空间的一种技术方法。

### 1.4 **参考资料**
[1]成一铮,林胜.基于对比学习的图像生成文本方法研究[J/OL].天津理工大学学报,1-9.
[2]安国成,江波,王晓龙,等.基于拓展图文对比学习的多模态语义对齐[J/OL].计算机工程,1-12.
[3]姜丽梅,李秉龙.面向图像文本的多模态处理方法综述[J].计算机应用研究,2024,41(05):1281-1290.


## 2. 任务概述

### 2.1 **系统目标**

系统的目标是开发一个多功能的图文助手应用，该应用可以基于文本描述从用户相册中检索图像，对图片进行编码匹配，对用户上传的图像获取详细内容描述。提高工作效率和创造力，尤其对教育工作者、设计师和内容创作者来说，能够快速找到和理解图像资料。同时提供一个直观，用户友好的应用，使非专业用户也能够轻松进行图像搜索和解释。

### 2.2 系统软件/硬件平台
CPU:无特殊要求
内存：2GB以上
显卡：无特殊要求

### 2.3 **系统创新点**

1.智能图片检索：用户可以通过输入文本描述快速找到相册中的相关图片。
2.多语言支持：支持多种语言的文本输入，用户可以使用中文、英文或其他语言输入描述进行图片检索，方便更多用户群体使用。
3.智能排序与推荐：根据用户历史搜索行为与图片使用频率，系统会对搜索结果进行智能排序，优先展示用户最近使用或与输入描述最相关的图片。
4.隐私保护和安全存储：应用严格遵守用户隐私协议，所有相册数据本地加密存储，用户可以自主选择是否上传编码数据到云端。支持双因素验证和数据加密传输。
## 3. 功能需求

### 3.1 **用户角色及权限**

明确用户角色，如普通用户、管理员等，并说明各角色的功能权限。

### 3.2 功能划分

### 3.3 需求分配

### 3.4 **功能描述**

详细描述各功能模块的交互流程和用例图，展示用户与系统的交互过程。

**系统功能需求分：**

1. **用户管理**
    - **账号注册**：用户可以通过注册功能创建账号，包括输入用户名、密码和验证邮箱/手机号。
    - **账号登录**：用户通过输入注册的用户名和密码进行登录，支持多次登录失败后锁定账号的机制。
    - **密码修改**：用户可以在登录后修改密码，需要验证旧密码。
2. **相册权限管理**
    - **相册权限申请**：系统启动时，需要申请用户手机相册访问权限，允许系统访问本地图像进行检索。
    - **权限检查与提示**：系统在启动或相关功能调用时检查权限状态，并在未授予权限时提示用户申请。
3. **文本输入与图像检索**
    - **文本输入**：提供用户输入文本描述的功能，用于匹配相册中的相关图像。
    - **图像检索**：根据用户的文本输入，检索本地相册中的图像，返回匹配结果。
4. **图像输入与文本描述生成**
    - 选择相册里的图像：
    - 选择功能：
        - 图片描述
        - 文案生成
        - 自动归类
        - AI修图
5. **图像处理与编码**
    - **相册图像编码**：使用本地预训练的图像编码模型，对相册中的图片进行编码并映射到特征空间。
    - **图像上传与同步**：用户可以选择是否将编码后的图像上传到服务器进行云端存储与同步。
6. **文本处理与编码**
    - **文本描述编码**：对用户输入的文本使用预训练的模型进行编码，生成特征向量，用于与图像编码进行匹配。
    - **多语言支持**：支持多种语言的文本输入，系统自动识别语言并生成相应的编码。
7. **智能推荐与排序**
    - **检索结果排序**：根据文本描述和图像的匹配度对检索结果进行排序，优先显示最相关的图像。
    - **智能推荐**：基于用户的搜索历史和使用行为，推荐潜在相关的图像。
8. **缓存与优化**
    - **本地缓存**：图像编码结果和检索结果可以本地缓存，避免重复处理，提高检索速度。
    - **缓存管理**：定期清理过期缓存，保持系统的高效运行。
9. **个性化相册管理**
    - **相册分类**：用户可以根据检索结果对图像进行分类，创建自定义的相册。
    - **标签管理**：支持用户为图片打标签，便于后续检索与管理。
10. **隐私保护与数据安全**
    - **数据加密**：所有本地存储和传输的图像、文本编码数据均采用加密技术，保护用户隐私。
    - **双因素验证**：登录系统时可以开启双因素验证，增加账户安全性。
11. **系统性能与扩展**
    - **并发处理**：支持多用户并发检索，确保高效处理每个用户的请求。
    - **可扩展性**：系统具备良好的扩展性，支持未来新功能的加入和技术升级。

这份完备的功能需求涵盖了用户管理、系统权限、图像与文本编码、检索优化、安全保障等多个方面，确保系统的功能性和用户体验。

---

## 4. 数据描述

### 4.1 数据词典

**4.1.1 注册信息**

- **标识符**：注册信息
- **描述**：用户在注册时输入的数据。
- **数据项**：
    - 用户邮箱（类型：字符串，范围：长度10-30，说明：符合邮箱格式）
    - 密码（类型：字符串，范围：长度6-20，说明：密码需符合大小写字母、数字和符号的组合规则）
    - 昵称（类型：字符串，范围：长度4-20，说明：可以包含中文、英文、数字或下划线）
    - 头像（类型：二进制数据，范围：<16k，说明：头像图片的二进制格式存储）
    - 生日（类型：日期，说明：用户生日，格式为年-月-日）
    - 手机号码（类型：字符串，范围：11位，说明：用户手机号码）

**4.1.2 注册结果**

- **标识符**：注册结果
- **描述**：系统返回用户注册时的操作结果。
- **数据项**：
    - 注册结果（类型：离散值，范围：【成功/失败】，缺省值：失败）

**4.1.3 登录信息**

- **标识符**：登录信息
- **描述**：用户登录时输入的数据。
- **数据项**：
    - 用户ID（类型：字符串，范围：长度4-12，说明：用户ID，系统保留ID范围为"0001"到"1000"）
    - 密码（类型：字符串，范围：长度6-20，说明：符合密码规则）
    - 登录状态（类型：离散值，范围：【在线/离线】，缺省值：在线）

**4.1.4 登录结果**

- **标识符**：登录结果
- **描述**：系统返回用户登录后的结果。
- **数据项**：
    - 登录结果（类型：离散值，范围：【成功/失败】，缺省值：失败，说明：连续三次失败将锁定用户）

**4.1.5 相册访问权限状态**

- **标识符**：相册访问权限状态
- **描述**：系统检查用户是否已授予相册访问权限。
- **数据项**：
    - 权限状态（类型：布尔值，范围：【已授权/未授权】，缺省值：未授权）

**4.1.6 文本输入与检索请求**

- **标识符**：检索请求
- **描述**：用户发起的文本检索请求。
- **数据项**：
    - 文本描述（类型：字符串，范围：1-256，说明：用户输入的检索关键词或句子）
    - 检索时间（类型：时间，范围：系统时间，说明：用户发起检索的时间）

**4.1.7 检索结果**

- **标识符**：检索结果
- **描述**：系统返回的与用户文本匹配的图像结果。
- **数据项**：
    - 图像ID（类型：整型，范围：0-999999，说明：与检索匹配的图像唯一ID）
    - 相似度（类型：浮点型，范围：0.0-1.0，说明：匹配度的分数）

**4.1.8 图像编码缓存**

- **标识符**：图像编码缓存
- **描述**：本地缓存的图像编码信息。
- **数据项**：
    - 图像ID（类型：整型，范围：0-999999，说明：图像的唯一标识）
    - 图像编码（类型：字符串，范围：1-1024，说明：图像的特征向量）
    - 缓存时间（类型：时间，说明：图像编码缓存的存储时间）

**4.1.9 用户历史检索记录**

- **标识符**：历史检索记录
- **描述**：用户的历史检索请求，用于智能推荐与排序。
- **数据项**：
    - 检索文本（类型：字符串，范围：1-256，说明：用户输入的检索文本）
    - 检索时间（类型：时间，说明：发起检索的时间）
    - 检索结果ID（类型：整型，范围：0-999999，说明：检索到的图像ID）

**4.1.10 用户行为日志**

- **标识符**：用户行为日志
- **描述**：记录用户在系统中的操作行为。
- **数据项**：
    - 操作类型（类型：字符串，范围：【检索/查看/下载/上传】，说明：用户操作的类型）
    - 操作时间（类型：时间，范围：系统时间，说明：记录操作发生的时间）

### 4.2 **数据库描述与设计**
- **工具**：MySQL 8.0
- **数据库名称**：ImageRetrievalSystem
- **表结构设计**：
    - 用户表（User）
        - 用户ID（UserID，主键，自动递增）
        - 邮箱（Email，唯一，非空
        - 密码（Password，非空，加密存储）
        - 昵称（Nickname，非空）
        - 头像（Avatar，二进制数据，允许为空）
        - 生日（Birthday，日期，允许为空）
        - 手机号码（PhoneNumber，唯一，非空）
        - 注册时间（RegisterTime，时间戳，默认当前时间）
        - 登录状态（LoginStatus，布尔值，默认离线）
        - 账号锁定（AccountLocked，布尔值，默认未锁定）
        - 相册权限表（AlbumPermission）
        - 用户ID（UserID，主键，外键关联User表）
        - 权限状态（PermissionStatus，布尔值，非空）
        - 授权时间（AuthTime，时间戳，默认当前时间）


    - 图像表（Image）
        - 图像ID（ImageID，主键，自动递增）
        - 用户ID（UserID，外键关联User表）
        - 图像路径（ImagePath，非空，存储图像在服务器上的路径）
        - 图像编码（ImageEncoding，字符串，非空，存储图像的特征向量）
        - 上传时间（UploadTime，时间戳，默认当前时间）
        - 检索历史表（SearchHistory）
        - 历史ID（HistoryID，主键，自动递增）
        - 用户ID（UserID，外键关联User表）
        - 检索文本（SearchText，非空）
        - 检索时间（SearchTime，时间戳，默认当前时间）
        - 图像ID（ImageID，外键关联Image表，允许为空，表示未选择图像）
        - 用户行为日志表（UserBehaviorLog）
        - 日志ID（LogID，主键，自动递增）
        - 用户ID（UserID，外键关联User表）
        - 操作类型（OperationType，非空，枚举类型【检索/查看/下载/上传】）
        - 操作时间（OperationTime，时间戳，默认当前时间）
    - 索引设计
        - 在Email、PhoneNumber、Nickname字段上建立唯一索引或普通索引，以提高查询效率。
        - 在User表的LoginStatus、AccountLocked字段上建立索引，用于快速筛选在线用户和锁定用户。
        - 在Image表的ImagePath、UploadTime字段上建立索引，以支持按上传时间或路径查询图像。
        - 在SearchHistory表的SearchText、SearchTime字段上建立索引，以支持按检索文本或时间查询历史记录。




### 4.3 **数据存储与访问**

- **图像编码结果的本地缓存**
    - 使用本地文件系统或内存数据库（如Redis）存储图像编码结果，以加快检索速度。当系统启动时，从服务器加载部分常用或热门图像的编码到本地缓存中。当用户发起检索请求时，首先检查本地缓存中是否存在匹配的图像编码，如果存在则直接返回结果；否则，从服务器获取编码并进行匹配。
- **服务器存储**
    -  图像文件及其元数据如图像路径、上传时间等，存储在服务器上。图像编码结果也存储在服务器上，但可以通过API接口进行访问。服务器使用关系型数据库（如MySQL）来管理这些数据。
- **访问策略**
    -  用户通过客户端应用访问系统，客户端与服务器之间通过HTTP/HTTPS协议进行通信。客户端发起请求时，服务器根据请求类型（登录、注册、检索等）执行相应的业务逻辑，并返回结果给客户端。对于敏感数据如密码，使用加密传输和存储。

---

## 5. 性能需求

### 5.1 **响应时间**

  - **检索请求的处理时间**:
      - 系统能够在用户提交检索请求后的2秒内返回结果。这包括从用户输入文本到系统处理文本、匹配图像编码、返回结果的全过程。
  -  **页面响应速度**:
      -  用户发出请求后能够及时响应数据和页面；系统消息和用户之间的消息能够及时送达。这包括登录页面、注册页面、检索结果页面等。
  -  **登录/注册响应时间**:
      -  用户提交登录或注册信息后尽可能块地，系统能够完成验证并返回结果。

### 5.2 **并发处理能力**

 -  系统应支持多个用户同时进行检索操作，而不会出现明显的性能下降或响应延迟。为实现这一目标，系统在支持多用户时可以考虑采用：
 -  （1）使用负载均衡器来分发用户请求到多个服务器上进行处理。
 -  （2）使用数据库连接池来管理数据库连接，提高数据库访问效率。
 -  （3）优化检索算法和数据结构，减少匹配时间。
 -  （4）使用缓存技术来减少重复计算和数据库访问次数。

### 5.3 **数据精确度与缓存优化**

  -  **本地缓存**:
      -  在用户设备上存储最近检索过的图像编码结果和匹配结果，以减少对服务器的访问次数。当用户再次发起相同的检索请求时，可以直接从本地缓存中获取结果。
  -  **服务器缓存**:
      -  在服务器上使用内存数据库如Redis来存储常用或热门图像的编码结果和匹配信息。当用户发起检索请求时，首先检查服务器缓存中是否存在匹配的结果；如果不存在，则进行完整的检索流程并将结果存入缓存中以便后续使用。

### 5.4 **适应性**
  -  **可扩展性**:
      -  系统设计时应考虑未来可能增加的新功能或模块如支持新的图像格式、增加新的检索算法等。为此，可以采用模块化设计思想将系统划分为多个独立的模块或组件，并定义清晰的接口和协议以便进行扩展和集成。
  -  **兼容性**:
      -  系统应兼容操作系统和浏览器平台至少包含Android，在此基础上尽可能扩展IOS等其他平台和操作系统。同时，系统还应支持不同版本的MySQL数据库和客户端设备以确保其广泛适用性。
  -  **安全性**:
      -  系统应采取多种安全措施来保护用户数据的安全性和隐私性，如使用HTTPS协议进行通信、加密存储敏感数据、限制用户权限等。同时定期对系统进行安全漏洞扫描和风险评估以确保其安全性。
---

## 6. 运行需求（接口需求规格）

### 1. **用户接口需求**

- **界面要求**：系统提供的用户界面必须友好，支持用户通过文本输入框进行描述，允许用户点击按钮执行图像检索操作。
- **响应时间**：用户进行文本输入后，检索结果的响应时间应在2秒以内。
- **错误提示**：系统在用户输入不正确的情况下，如无权限访问相册或输入文本为空，需提供明确的错误提示。

### 2. **相册权限接口**

- **权限请求**：系统在首次运行时请求访问用户手机的相册权限，并在权限被拒绝时反复提醒，允许用户进入手机设置手动启用权限。
- **权限状态检测**：系统启动或相关操作时，能够检测相册访问权限是否已授权，并根据状态采取不同的操作（如授权则继续，无授权则提示用户）。

### 3. **文本输入与图像检索接口**

- **输入数据格式**：文本输入的格式应为UTF-8编码的字符串，长度限制为256字符以内，支持多语言。
- **检索数据接口**：系统接收用户输入的文本，通过REST API将文本编码并与图像特征匹配。该接口要求采用HTTPS协议进行通信。
- **检索响应**：系统根据文本描述返回与之匹配的图像信息，图像结果应包括图像ID、图像URL以及相似度评分等数据。

### 4. **图像处理接口**

- **图像编码**：通过本地图像编码模块对用户相册中的图像进行特征提取，编码后的特征向量通过接口传递至服务器进行存储和检索。
- **图像上传接口**：如果用户选择上传图像，系统将提供上传接口，支持JPEG、PNG格式图像，最大图片大小限制为5MB。

### 5. **缓存管理接口**

- **本地缓存接口**：系统对已编码图像和检索结果进行本地缓存，提供接口进行缓存管理，如缓存大小限制和过期清理。
- **缓存刷新**：当相册中新增图像或用户更新检索文本时，系统提供刷新接口，重新编码和缓存相关图像特征。

### 6. **用户账号管理接口**

- **注册接口**：用户通过移动端提供的注册界面输入邮箱、密码等信息，系统通过REST API将用户信息传递至服务器进行注册，并返回注册结果。
- **登录接口**：用户登录时，系统通过登录接口验证用户身份，验证通过后返回令牌（Token）以维持会话。

### 7. **多模态匹配接口**

- **文本编码接口**：系统将用户输入的文本通过接口传递到本地或服务器进行编码，并与图像特征向量进行匹配。
- **多模态匹配接口**：提供API对比文本和图像特征，返回匹配度最高的前N个图像，并将结果传回前端进行展示。

### 8. **安全接口**

- **数据加密**：系统在传输用户信息（如登录信息、相册图像数据等）时，必须通过HTTPS协议进行加密传输。
- **身份验证**：系统应通过OAuth 2.0或其他身份验证机制确保用户会话的安全，提供双因素认证（2FA）选项。

### 9. **日志与监控接口**

- **用户行为日志接口**：系统应记录用户的每次操作，如检索、查看图像、下载等，并通过日志接口上传至服务器进行存储。
- **监控接口**：系统提供接口给管理员监控运行状态，包括检索请求的数量、响应时间和系统异常等信息。

---

### 7. 其它需求

7.1 **可靠性**

确保系统在高负载下能够稳定运行，并保证数据处理的正确性。

7.2 **可维护性**

说明系统模块化设计，易于后期扩展和维护。

7.3 **安全性**

说明用户数据和系统操作的安全性策略，如数据加密、隐私保护等。

7.4 **可移植性**

系统是否可以扩展到其他平台或环境，如从Android扩展到iOS平台等。

这个大纲结合了你项目的具体特点与需求分析文档的标准结构，供你在撰写时参考和完善。

7.5  **易用性**

---

## 8. 用户需求与系统需求规格对照表

## 9. 附录
